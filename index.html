<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üçÅ Haliport ‚Äî Private 1:1 Chat</title>
<style>
  :root{ --bg:#0b0f14; --panel:#121923; --panel2:#0f151e; --text:#e9f0f7; --muted:#9fb0c2; --accent:#57acff; --border:#1f2b3b; --glass:rgba(255,255,255,.06); --danger:#ff6b6b; }
  *{box-sizing:border-box} html,body{height:100%}
  body{margin:0;background:var(--bg);color:var(--text);font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial}
  .app{display:flex;flex-direction:column;min-height:100vh}
  .header{height:64px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;padding:12px 18px;background:var(--panel)}
  .scroll{flex:1;overflow:auto;padding:18px}
  .row{display:flex;margin:10px 0;position:relative}
  .me{justify-content:flex-end}
  .bubble{max-width:900px;width:fit-content;background:#172131;border:1px solid var(--border);padding:12px 14px;border-radius:16px;font-size:1.05rem;line-height:1.5;position:relative}
  .me .bubble{background:#0f2744;border-color:#133659}
  .meta{color:#9fb0c2;font-size:.85rem;margin-top:6px;text-align:right}
  .composer{position:sticky;bottom:0;display:flex;gap:12px;align-items:flex-end;border-top:1px solid var(--border);padding:14px 16px;background:var(--panel)}
  .textarea{flex:1;min-height:56px;max-height:220px;padding:14px;border-radius:14px;border:1px solid var(--border);background:var(--panel2);color:var(--text);resize:vertical;font-size:1.05rem;line-height:1.5;outline:none}
  .send{background:#1b87f3;border:0;color:#fff;padding:14px 22px;border-radius:14px;cursor:pointer;font-size:1rem}
  .iconbtn{border:1px solid var(--border);background:var(--panel2);color:var(--text);border-radius:12px;cursor:pointer;height:48px;width:48px;display:grid;place-items:center}
  .filecard{display:flex;align-items:center;gap:10px;flex-wrap:wrap}
  .filename{word-break:break-all}
  .btn-min{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:10px;border:1px solid var(--border);background:var(--glass);cursor:pointer;color:#e7edf4;text-decoration:none}
  .btn-min:hover{background:rgba(255,255,255,.12)}
  .badge{ display:inline-flex; align-items:center; gap:6px; padding:3px 10px; border-radius:999px; font-size:.78rem; background:#10263e; color:#b8d5ff; border:1px solid #1c3a5e }
  .tomb { font-style:italic; color:#d2dcea }
  .expiry{ color:var(--danger); font-size:.85rem; margin-top:6px }
  .sys{ color:#b7c6d8; font-size:.86rem; margin-top:6px; }
  .row.me .sys{ text-align:right; }
  .status{ color:#9fb0c2; font-size:.92rem; }

  .kebab{ position:absolute; top:6px; right:6px; width:32px; height:32px; display:grid; place-items:center; font-size:18px; background:var(--glass); border:1px solid rgba(255,255,255,.18); border-radius:10px; color:#e7edf4; cursor:pointer; opacity:.7; }
  .bubble:hover .kebab{ opacity:1; }
  .menu{ position:absolute; top:42px; right:6px; background:#0e1622; border:1px solid var(--border); border-radius:12px; box-shadow:0 12px 30px rgba(0,0,0,.4); display:none; min-width:170px; z-index:5; }
  .menu.open{ display:block }
  .menu button{ width:100%; text-align:left; padding:10px 12px; background:transparent; border:0; color:#e7edf4; cursor:pointer; font-size:.95rem }

  .viewer-overlay{ position:fixed; inset:0; background:rgba(0,0,0,.6); display:none; z-index:60; }
  .viewer-overlay.open{ display:block; }
  .viewer{ position:fixed; left:50%; top:50%; transform:translate(-50%,-50%); width:min(1200px, 96vw); height:min(80vh, 900px); background:#0e1520; border:1px solid var(--border); border-radius:16px; box-shadow:0 30px 120px rgba(0,0,0,.7); display:none; z-index:61; overflow:hidden; }
  .viewer.open{ display:flex; flex-direction:column; }
  .viewer-header{ display:flex; align-items:center; justify-content:space-between; padding:10px 14px; border-bottom:1px solid var(--border); background:#101827 }
  .viewer-title{ font-weight:600; color:#dfeafb; overflow:hidden; text-overflow:ellipsis; white-space:nowrap }
  .viewer-close{ border:1px solid var(--border); background:var(--glass); color:#e7edf4; padding:6px 10px; border-radius:10px; cursor:pointer }
  .viewer-body{ flex:1; background:#0b111b }
  .viewer-body iframe, .viewer-body embed, .viewer-body img, .viewer-body video{ width:100%; height:100%; border:0; display:block; } /* video added */
  .viewer-fallback{ color:#cfe1f7; padding:20px; }

  /* ---- Upload Options Modal ---- */
  .modalOverlay{ position:fixed; inset:0; background:rgba(0,0,0,.6); display:none; z-index:70; }
  .modal{ position:fixed; left:50%; top:50%; transform:translate(-50%,-50%); width:min(520px, 96vw); background:#0e1622; border:1px solid var(--border); border-radius:16px; display:none; z-index:71; }
  .modal.open, .modalOverlay.open{ display:block; }
  .modal header{ padding:14px; border-bottom:1px solid var(--border); font-weight:600; }
  .modal .content{ padding:14px; display:grid; gap:12px; }
  .rowGrid{ display:grid; grid-template-columns:repeat(3, 1fr); gap:10px; }
  .modal input[type="number"], .modal input[type="password"], .modal input[type="text"]{
    background:#101725;color:#e7edf4;border:1px solid var(--border);border-radius:10px;padding:10px;width:100%;
  }
  .modal footer{ display:flex; justify-content:flex-end; gap:10px; padding:12px; border-top:1px solid var(--border); }
  .chk{ display:flex; align-items:center; gap:10px; color:#cfe1f7; }
</style>
</head>
<body>
<div class="app">
  <div class="header">
    <div><b id="title">Connecting‚Ä¶</b></div>
    <div id="presence" class="status">‚Äî</div>
  </div>

  <div class="scroll" id="log"><div class="status">Open this URL on two devices to start chatting.</div></div>
  <p class="status" style="margin:0 18px 8px">Enter to send ‚Ä¢ Shift+Enter newline ‚Ä¢ Paperclip to attach ‚Ä¢ ‚ãØ to recall ‚Ä¢ üëÅÔ∏è to view inline</p>

  <div class="composer">
    <button id="attach" class="iconbtn" title="Attach files" aria-label="Attach files">üìé</button>
    <input id="fileInput" type="file" multiple hidden />
    <textarea id="msg" class="textarea" placeholder="Type a message"></textarea>
    <button id="send" class="send">Send</button>
  </div>
</div>

<!-- Viewer -->
<div id="viewerOverlay" class="viewer-overlay"></div>
<div id="viewer" class="viewer" role="dialog" aria-modal="true" aria-labelledby="viewerTitle">
  <div class="viewer-header">
    <div id="viewerTitle" class="viewer-title">Preview</div>
    <button id="viewerClose" class="viewer-close">Close</button>
  </div>
  <div id="viewerBody" class="viewer-body"></div>
</div>

<!-- Upload Options Modal (TTL, Password, Allow download) -->
<div id="uOverlay" class="modalOverlay"></div>
<div id="uModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="uTitle">
  <header id="uTitle">Upload Options</header>
  <div class="content">
    <div class="rowGrid">
      <div><label>Days</label><input id="ttlDays" type="number" min="0" value="0"></div>
      <div><label>Hours</label><input id="ttlHours" type="number" min="0" max="23" value="0"></div>
      <div><label>Minutes</label><input id="ttlMins" type="number" min="0" max="59" value="0"></div>
    </div>
    <div><label>Password (optional)</label><input id="ttlPass" type="password" placeholder="Enter password for receiver"></div>
    <label class="chk"><input id="allowDl"
